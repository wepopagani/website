{{ $data := index site.Data site.Language.Lang }}
{{ if $data.contact.contact.enable }}
{{ with $data.contact.contact }}
{{"" | safeHTML}}
<form id="contact-form" class="form-meghna" method="POST" action="https://formspree.io/f/mgvwelzz"> 
    <input type="hidden" name="form-name" value="Contact form CreaLab">
    <div class="container pb-5">
        <div class="row">
            <div class="col-lg-12">
                <div class="title text-center wow fadeIn" data-wow-duration="500ms">
                    <h2>{{ with .title }} {{ index (split . " ") 0 | safeHTML }} {{ end }}<span class="color">
                            {{ with .title }} {{ after (len (index (split . " ") 0)) . | safeHTML }} {{ end }}</span></h2>
                    <div class="border-meghna"></div>
                </div>
            </div>

            <div class="contact-info col-lg-6 wow fadeInUp" data-wow-duration="500ms">
                <h3>{{ .subtitle | markdownify }}</h3>
                <p> {{ .content | markdownify }} </p>

                {{ if .contact_form.enable }}
                <div class="contact-details">
                    {{ range .contact_list }}
                    <div class="con-info clearfix">
                        <i class="{{ .icon }}"></i>
                        <span>{{ .info }}</span>
                    </div>
                    {{ end }}
                </div>
                {{ end }}
            </div>

            {{ if .contact_form.enable }}
            {{ with .contact_form }}
            <div class="col-lg-6 wow fadeInUp" data-wow-duration="500ms" data-wow-delay="300ms">
                    <div class="form-group">
                        <input type="text" placeholder="{{ .name }}" class="form-control" name="name" id="name" autocomplete="name" required>
                    </div>
                    <div class="form-group">
                        <input type="email" placeholder="{{ .email }}" class="form-control" name="email" id="email" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <input type="text" placeholder="{{ .subject }}" class="form-control" name="subject" id="subject" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <textarea rows="6" placeholder="{{ .message }}" class="form-control" name="message" id="message" required></textarea>
                    </div>
                    <div id="cf-submit">
                        <button type="submit" id="contact-submit" class="btn btn-transparent btn-block" value="{{ .submit }}">{{ .submit }}</button>
                    </div>
                    <input type="text" name="bot-field" style="display: none;" />
                </form> <!-- Chiusura form spostata qui -->
                <div id="success-message" class="alert alert-success mt-4" style="display: none;">
                    <strong>Grazie!</strong> Il tuo messaggio è stato inviato con successo.
                </div>
                <div id="error-message" class="alert alert-danger mt-4" style="display: none;">
                    <strong>Errore!</strong> Si è verificato un problema durante l'invio del modulo. Riprova più tardi.
                </div>
            </div>
            {{ end }}
            {{ else }}
            <div class="contact-details">
                {{ range .contact_list }}
                <div class="con-info clearfix">
                    <i class="{{ .icon }}"></i>
                    <span>{{ .info }}</span>
                </div>
                {{ end }}
            </div>
            {{ end }}
        </div>
    </div>
</form> <!-- Chiusura form riposizionata correttamente -->
{{"" | safeHTML}}
{{ end }}
{{ end }}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("contact-form");
    const successMessage = document.getElementById("success-message");
    const errorMessage = document.getElementById("error-message");

    form.addEventListener("submit", function (event) {
        event.preventDefault();
        
        // Controlla se l'honeypot è stato compilato
        if (document.querySelector('input[name="bot-field"]').value !== '') {
            return; // Se l'honeypot è stato compilato, blocca l'invio
        }

        fetch(form.action, {
            method: "POST",
            body: new FormData(form),
            headers: {
                'Accept': 'application/json'
            }
        })
        .then(response => {
            if (response.ok) {
                form.reset();
                successMessage.style.display = "block";
                errorMessage.style.display = "none";
            } else {
                response.json().then(data => {
                    if (Object.hasOwn(data, 'errors')) {
                        errorMessage.textContent = data["errors"].map(error => error["message"]).join(", ");
                    } else {
                        errorMessage.textContent = "Oops! C'è stato un problema con l'invio del modulo.";
                    }
                });
                successMessage.style.display = "none";
                errorMessage.style.display = "block";
            }
        })
        .catch(error => {
            errorMessage.textContent = "Oops! C'è stato un problema con l'invio del modulo.";
            console.error("Errore durante l'invio del modulo:", error);
            successMessage.style.display = "none";
            errorMessage.style.display = "block";
        });
    });
});
</script>